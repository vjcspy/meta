name: Auto Merge master to deployment/stock/production

on:
  push:
    branches:
      - master

jobs:
  merge-to-deployment:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Configure Git User
        run: |
          git config --global user.email "workflows@github.com"
          git config --global user.name "workflows"

      - name: Fetch latest changes from master
        run: |
          git fetch origin master

      - name: Checkout to deployment/stock/production
        run: |
          git fetch origin deployment/stock/production
          git checkout deployment/stock/production

      - name: Pull master into deployment/stock/production
        run: |
          git config pull.rebase false
          git pull origin master

      - name: Push master into deployment/stock/production
        run: |
          git push origin deployment/stock/production
