import { FlagRepo } from '@modules/core/repo/flag.repo';
import { XAppRequestContext, XLogger } from '@nest/base/dist';
import { Injectable } from '@nestjs/common';
import * as shell from 'shelljs';

@Injectable()
export class TestbedService {
  private readonly logger: XLogger;

  constructor(
    private xAppRequestContext: XAppRequestContext,
    private flagRepo: FlagRepo,
  ) {
    this.logger = new XLogger(TestbedService.name, this.xAppRequestContext);
  }

  getTestbedData() {
    this.logger.log('Get Testbed Data');

    return 'Test bed data';
  }

  async clearChat() {
    const result = shell.exec(
      `curl 'https://chat.openai.com/backend-api/conversations' -X PATCH -H 'User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/116.0' -H 'Accept: */*' -H 'Accept-Language: en-US' -H 'Accept-Encoding: gzip, deflate, br' -H 'Referer: https://chat.openai.com/c/c1794295-9ff8-49be-aea8-ccbbd9795b24' -H 'Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6Ik1UaEVOVUpHTkVNMVFURTRNMEZCTWpkQ05UZzVNRFUxUlRVd1FVSkRNRU13UmtGRVFrRXpSZyJ9.eyJodHRwczovL2FwaS5vcGVuYWkuY29tL3Byb2ZpbGUiOnsiZW1haWwiOiJzYW50aG9zaC5hcnVuYWdpcmlAeWFob28uY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWV9LCJodHRwczovL2FwaS5vcGVuYWkuY29tL2F1dGgiOnsidXNlcl9pZCI6InVzZXItT3lBcHhOc3RFN2hHQjZPTzFjME12dGd1In0sImlzcyI6Imh0dHBzOi8vYXV0aDAub3BlbmFpLmNvbS8iLCJzdWIiOiJhdXRoMHw2NGEwYzhhM2Q0NzY2Njg1ZjZjOGNjOTMiLCJhdWQiOlsiaHR0cHM6Ly9hcGkub3BlbmFpLmNvbS92MSIsImh0dHBzOi8vb3BlbmFpLm9wZW5haS5hdXRoMGFwcC5jb20vdXNlcmluZm8iXSwiaWF0IjoxNjk0MjMwMDUzLCJleHAiOjE2OTU0Mzk2NTMsImF6cCI6IlRkSkljYmUxNldvVEh0Tjk1bnl5d2g1RTR5T282SXRHIiwic2NvcGUiOiJvcGVuaWQgcHJvZmlsZSBlbWFpbCBtb2RlbC5yZWFkIG1vZGVsLnJlcXVlc3Qgb3JnYW5pemF0aW9uLnJlYWQgb3JnYW5pemF0aW9uLndyaXRlIG9mZmxpbmVfYWNjZXNzIn0.MfaxlE1uQKebBmiP0fhAXakJO4YmlrJUBwGsq0OGk5J8r4tSbRqIE5m4wi9f7JQGmapp8qSIzOge9QmkwPXlpuhZ612gMvmE3PTyBLdSonUKAnvL1ZpE09n434-IQLbz4tijztQxyC2PiXm69xTa588LeYHaH6tfjWRQOZ_5TYtw9ML41bMEfDhH5ZeIuKKsrRNLBhLfeQdUSoeqWCXKuS4ArZPv1IPdsuOQ_QZ0n-dq7gheieq10QtxNtLQz7j-Ubq23g5EgZW3DgP5pNp38h9tEUAbA4NnZZuXKHPW8PggdlkYBBNe-lZ-2JosRQWuo53--89BVUyke0YN4O63ow' -H 'Content-Type: application/json' -H 'Origin: https://chat.openai.com' -H 'Alt-Used: chat.openai.com' -H 'Connection: keep-alive' -H 'Cookie: cf_clearance=T6FY18uVQBkffgcFhcm0Lh3nXIS90_WMIyXl1YPMqJI-1694230040-0-1-19a088ff.3615800e.1e94c52f-0.2.1694230040; intercom-device-id-dgkjq2bp=6a7af34e-5538-4b78-a7b3-44a70112791a; __Host-next-auth.csrf-token=54966acff30dcff1bdd6a0f60f165bdc71e0179d7534f8e2108face3e45177f6%7C63d6eee320c544bfde834b0f3f0cf3ad96f1839636763e719cefea2e1ef3ae17; __Secure-next-auth.callback-url=https%3A%2F%2Fchat.openai.com%2F; _cfuvid=v3YBh_s_gNJaCcF4UoBcF6bkoitWgo8Ee7RqtSMP.Y0-1694230037748-0-604800000; _dd_s=rum=0&expire=1694238356810; __Secure-next-auth.session-token=eyJhbGciOiJkaXIiLCJlbmMiOiJBMjU2R0NNIn0..EEm2m2zqOk4KMnWG.Ojl1WuYH4Bo8vSiXi4f0hNKsGdULQtlOxuz0wEDoCQ7IXi5QmHkmdS1MUlq3OEAJ9QfHC4fjZmfThgVnfQVWykOV41xKQ91uClrb0qX7Zx_hUp13MSCeZyiOKhE783CnhVpgTBdP3KsqNvg_eoLpo1S5ciNkz3yEFQGrFyIsqFdZ_YsEsu1mP35IZnC7vZFGcx8IbpXH-sZFrHNSAJIDIkfhUd5jG7C_6k3DRjx33e0Ps_Rbp9MfJM4pe1PMUnKlEmC5jEVggF9myu3zbpl72a4e9g_G6k_kUJx8ubjdUiqBrAf7XKpGpG2Wz3ZoXeQMGkd7XQGn-YtgFEsep4Apl7PSpba8GYLF7JQnkhCFKe77dN68Gc_ZKCBT3uzdmCqfxIqksbLQ7CsBXgpS9jMtrB2K063wLi57T_F_82hN6MqVFhOWMjwWVP0syGGqACq-SR6LHroN8-rPx9fCjppNuknIo2FDMiN_dxHXqQAk4Ht5q5zs1HiKypUFvk08xUKso5aU7FZuYCpTuXB7Rd0NSA2N7PgTKZtFORkuAgJkg2Rnl5bZd4EtUbAKOrMlf0vsRdfltdwXr9I_kNFWrcQT3sOJd1bhv5iGe-o1ALeFp_xY30dN5Qrqc37ycbR5U2YItoFW68loQkjOcKAni1wJkbS_qKfuZURGOgQ7g2R0C1uCdyr2m9bSsKioE_UO4wBF74viBa2tdBiT0_8ym8ADKfZ7bkx_MHJYQS4sGGfop2hjXGEKvox3hWDjwEXnJ4brIqVFWvDScpqnv0OyQbh3bV4PM7FD_APS9QDwWYiqnyCKmNXLv1YSOQaxi2jK60gLk4IswcpzZjng8OGRpPjAaZt2uf19xtwkb31KsL9GWofp3cIpicMAPiv-6xL1fWvjLPAgqfoD7FJhDCvyF1x8sPxbCgzpdWf8t2wgLC8QWg5gfluO9IlyVhJM8fNTWaXRAPc-S6CHOeotwAFavSdVwIaTuaXte6Ia98uf0E0F_-mO1VbOSHb7apjguUhMHp346cnKmY-ZM11QmcHeJbBsBm_XY3XXTkCmWKVUNTU0Aff2pKsRChjpp5wIOaKwiCSg4GMxP0-pke_x88EL6hoNkE31GIotbMS4f2qToXudHDFlxzRyci9DUVr_fdTMEHZnbQBB-LU2jfR-Ac-NnUB-CdjFIAY0jhV9MFCFLRkKkFdt1tkViwO3wESO1PUPFAX14_9JM92e7f81gWbldoNMgCp14pNFMRh2xizK65HTS-W9-wnpJkwL9qh0E2NduHMNSYk6dbltGPbxFXZxPP2wH3DLAiFNV7PJeB2rfOsKhGi9V43g1_QopOOlt5ZkJh_nUcjhe-5frYpRJtEpZ-f4Y7taukqAUA2pab_0L0MCAm1LeP5dpn7fxDvmI_d7Ghe-F18z2ktm-r_4nhDOPNk-LtLrEJzHhcb8UAJUU3A72-yvoadniTrh_wRp1czY80kjmwcSI4ldwJa8PWfR9yFp_WzTFhbPuw2jgUwdOoa7y5uUoXkw4SfOulV_rkOhckZMErjTSEH6EG8rfiHFJnLQW-s8uPfv46LLDDyQ_LGtAOBOeCz60PTrhebLSX8XAZ926VBTZquhLfhCbfR9wpKEAxqsAOaioxedTaFMHfIUVejpp62ydQzWvYT07cNWzwnK56WM_E-1miOt0UUVYL1Y03HNHm_dp-KTKEoreiXsFdqslKqIkV0vtMVhxx7TLF_FEhQFiw3hpJ8IUOnoaLj3INcNNeRemEB5aEqB5pZ_f_Vob0dM9NfG-qpp3N1JUw39FZXHz_ppzdII13e-ks5YYSNjcwr_J7fCaaiKRrGz93YIlFuXNc7G44415qWVIlYu4KYWtOErDosOZfQ-Vdh5Zz9O_4RB-K1YtwJRGFnH9QSHMcNLzHvPLJIsCdqVMAkMAbiuVZDWLL4mInTuw0kIyzCG-p7wwj_bp2M1P-Pi4pioiFbj77VtWVUcEwFYFW87kWBPhCh7T3FukOeIdlRab5MpGfmvtFgy4HJhP2n1ngR7WfMLFzOsFiVOyJzrYFswo2dmvA8GYqNXLU-JGbWQ9AYVgaKJkDu7gf7l3HKcEn2WrFFjbPuocd9IVxEIkS4d5A72IeChNAh7PG-4WolvJ-PLeksG0BomUvgazYncm893RSLS8-3sNpUnY6R78vj2m-bIDqrS8kKKnwmRLSY8Dz-x7juVRNOL_j1AFNeC3zHPp3VvvxF1gbcwuSq4Z62Qp2xVmbiAcX1dbK6e1Lgkw-LTj6OxanZfpExinq5dblovc_5Nknd8ma4b-pmYxDZzGeAnviSQCwbRpvE6j6ZF0e6cLrCPJdNrI4xSMhZG0U0Rj5Zx-Qm6xnuihN6Wgyh29cQqfcJIoGavZI7LrUM0kn39zj4LXQuCkboZTM2GKmJOBNVAKh7TciqJ51IQsAWXYhQypha7Xv0qVaw7umDZJK-cYgxSzXsnC-_gs1YH-5T_8pqJFd7y1HqiVL7XRSnSABb4pKW-QTYnL7joopH5-dvOdtzY2iepqFe91pdcigweIePeUmRmKu0W5twOXBgpcGaHYAL6D2T3qqeSjeWc3BzdkYOckIRVA9-6ziXIffGmNXW_a1hQVtTpveUJH4BCqnYLZbdXSyIuPG9QYh-QdB5zijqOMu522o45vbeoYKAIPEoN3XxrP1X3vvPozb3BN6WgKJ3L5SilxIZOiWawFRL_d4kFQKmXsspPpKSyrY_aFZxPGDuB95an3sl_cz23XuKGj0eLGxW5iiBFeT1MWX94ET3SmLrnPWgaY8fz9rkjBK29axShzkvlBvjsLeJFkMYqTtVydpHE-FbzyY8owqjPwg9lgAkU_6PCb169xzcx1KytO8FMQ_kIU1qqmIF59jmikUuqNP9onG_F988C6cmmB2lA_AZHFQ.oRHercNv0MsZhSUtCpuBOA; _puid=user-OyApxNstE7hGB6OO1c0Mvtgu:1694237420-178YJ%2F4TDrsv2CXWQ5As9OKcyUE1a4c%2F06SagQjLMrM%3D; _uasid="Z0FBQUFBQmtfQUxzeVN0d0h2dlZYLUljWVRoLTh6bzZBOUZPSjVjTjROVEMxNl9pamJxYWE3Mmc5bTF2ZENHY3JzZGpKbWczSDhRV1oyXzNEN2xWZVF5cnRReGluX2VOT3RLRnFBcGdkMDhkcUZpRWFGX0pOaTJOcGwzMU82RS1HZXhycVZtY1ExSVlXcmlUZFc5QVNITkhtXzBMZ2tqUU5YYi1SWDUyblZNWlhxbHhrZWN0bkdsZmk4bE5MNU1GYU5NVGtvdUZVNVE2NktsLTZ4RVc3MGNJWkdlY1ItNGlkWUNzRE11bTU1bHRJYkF0c0dpdlVHZTR4eTZJRmk4UGhiY0Z6X1k4VFlxVHhEMThuNEg4OHFNZTFoZDBYeTZ1UDR0c3BBN3RMMHlaMHNsVW9GY1NacThLdXVhRDFkcG9vN0l5dURuSU9HYlNTSEh4M3VJNnFBUGZ3WlR6dzdGV0hRPT0="; __cf_bm=BaV0zQwyKRimryCYpZGyIuXfEGjTH41Q8uTHyTx6THM-1694237410-0-AQZ6TYT/f1ruo4bdyWWg792S/qosVjZmvsAsl5gj7kCVGnZDaMIN3Ysw79Eu7nhff4HPYAXFJ2TJVceUkItq1o8=' -H 'Sec-Fetch-Dest: empty' -H 'Sec-Fetch-Mode: cors' -H 'Sec-Fetch-Site: same-origin' -H 'TE: trailers' --data-raw '{"is_visible":false}'`,
      { silent: true },
    );

    if (result.code === 0) {
      return typeof result.stdout === 'string' &&
        result.stdout.includes('"success":true')
        ? 'ok'
        : 'fail';
    }
  }
}
